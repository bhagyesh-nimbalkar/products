@model CustomerProductViewModel

<div class="p-3">
	<div class="d-flex flex-row  align-items-center gap-3 mb-5">
		<a asp-controller="Home" asp-action="Index">
			<span><i class="bi bi-arrow-left-circle-fill fs-4"></i></span>
		</a>
		<h5 class="mt-2 fw-bolder">New Order</h5>
	</div>
	<form asp-action="SubmitOrder" method="post">
	<div class="card shadow-sm">
		<div class="card-body p-0">
			<div class="p-3">
			<div class="d-flex flex-column gap-3">
				<div>
					<h3>Customer Details</h3>
				</div>
				<div class="d-flex gap-5">
					<div>
						<label>Customer ID & Name</label>
					<select class="form-select" aria-label="Customer ID & Name" id="CustomerId">
						@foreach(var obj in Model.Customer.CustomerNames)
						{
							<option value=@obj>@obj</option>
						}
					</select>
				 </div>
					<div >
						<label>Purchase order no (PO)</label>
						<input value="@Model.Customer.PurchaseId" type="text" class="form-control" id="PurchaseId" placeholder="Purchase order no (PO)" readonly>
					</div>
					<div>
						<label>Purchase order date</label>
						<input  type="date" class="form-control" id="datePicker" placeholder="name@example.com">
					</div>
				 </div>
			 </div>
			 </div>
			 <hr />
			 <div class="p-3 d-flex gap-lg-5">
				 <div>
					<h3>Product Details</h3>
				 </div>
					<div class="d-flex gap-3">
					<div class="d-flex align-items-center">
						<i class="bi bi-search text-secondary" style="transform:translateX(25px) "></i>
						<input  class="form-control" list="productOptions" style="padding-left:35px; min-width:400px;" id="productSearch" name="productSearch" placeholder="Search product...">
						<datalist id="productOptions">
							@foreach (var product in Model.Products.ProductNames)
							{
								<option value="@product.ProductName"></option>
							}
						</datalist>
					</div>
					<div class="d-flex align-items-center">
						<input type="number" id="QtyNumber" class="form-control border border-1 shadow-sm" style="max-width:100px;" placeholder="Qty">
					</div>
					<div class="d-flex align-items-center">
						<input onclick="AddProduct()" type="button" class="form-control border border-1 shadow-sm btn-primary" value="Add">
					</div>
					</div>
			 </div>
			<div id="productTable"class="px-5">
			</div>
			<input type="hidden" id="ProductListJson" name="ProductListJson" />
			<button type="submit" class="btn btn-success mt-3 ms-5 mb-5">Save</button>
		</div>
	</div>
	</form>
</div>

@section Scripts {
	<script>
		const allProducts = [
			{ProductName:"BRZ06 - Revelol 25H Tablets",MRP:83},
			{ProductName:"GOYO3 - 100 Tablets",MRP:250},
			{ProductName:"JMT01",MRP:67},
			{ProductName:"APZ01 - Folitrax Tab 5",MRP:105},
			{ProductName:"EHL01 - Solvin Nasal Spray",MRP:78},
			{ProductName:"FND05 - Zerodol SP 100/15/325",MRP:122}
		]
		const productList = [];
		document.getElementById('datePicker').valueAsDate = new Date()
		window.AddProduct = function() {
			const productName = document.getElementById("productSearch").value;
			const qtyInput = document.querySelector('input[type="number"]');
			const qty = parseInt(qtyInput.value);
			const customerId = document.getElementById("CustomerId").value;
			const purchaseId = document.getElementById("PurchaseId").value;
			const orderDate = document.getElementById("datePicker").value;


			const selectedProduct = allProducts.find(p => p.ProductName === productName);

			if (!selectedProduct) {
				alert("Product not found!");
				return;
			}

			if (!qty || qty <= 0) {
				alert("Please enter a valid quantity.");
				return;
			}

			const productEntry = {
				CustomerId:customerId,
				OrderId:purchaseId,
				OrderDate:orderDate,
				ProductName: selectedProduct.ProductName,
				MRP: selectedProduct.MRP,
				Qty: qty,
				Total: selectedProduct.MRP * qty
			};

			productList.push(productEntry);
			console.log("Added:", productEntry);
			
			document.getElementById("ProductListJson").value = JSON.stringify(productList);

			// Clear inputs
			document.getElementById("productSearch").value = "";
			qtyInput.value = "";

			renderProductTable();
		}

		function renderProductTable() {
			let html = `<table class="table table-bordered mt-3">
				<thead><tr><th>Product</th><th>MRP</th><th>Qty</th><th>Total</th></tr></thead>
				<tbody>`;
			productList.forEach(p => {
				html += `<tr>
					<td>${p.ProductName}</td>
					<td>₹${p.MRP}</td>
					<td>${p.Qty}</td>
					<td>₹${p.Total}</td>
				</tr>`;
			});
			html += "</tbody></table>";
			document.getElementById("productTable").innerHTML = html;
		}
	</script>
}
